---
description: Additional network methods  
---

# Table of contents
* Bypass flow control (network evasion)
* Tamper/craft TOE outputs (pivoting, output poisoning)


# Bypass flow control (network evasion)
The typical example of flow control as a primary security function is a firewall function. The actual flow control functionality will depend on the TOE. In this example, _bypassing control flow_ means _evading the FW rules_. Similar types of attacks can concern:

* Network switches: bypassing the VLAN segregation
* Diodes: bypassing the unidirectionnality, or the content inspection...
* VPN: bypassing the tunnel protection, or the kill switch (e.g. allowing cleartext to flow after a tunnel failure),
* etc.


## Layer 2 (internet layer) attacks 
This section is mostly relevant for evasion of products sich as switches, notably to bypass VLAN segregation.

[TODO] To be defined following:
 - [nsa23]:  National Security Agency | Cybersecurity Information Sheet IPv6 Security Guidance, 2023
 - [Ull14]:  Johanna Ullrich, Katharina Krombholz, Heidelinde Hobel, Adrian Dabrowski, Edgar Weippl  - IPv6 Security: Attacks and Countermeasures in a Nutshell (Usenix 2014) 
 - [WWW-layer2](https://www.whitewinterwolf.com/posts/2017/10/10/practical-network-layer-2-exploitation-introduction/#series-toc)
 - [Hacktricks-network](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network)

## Reverse proxies
[TODO] To be defined following:
 - https://www.sans.org/blog/http-request-smuggling-abusing-reverse-proxies/
 - https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies, 
 - https://threatpost.com/url-parsing-bugs-dos-rce-spoofing/177493/ and 
 - https://www.acunetix.com/blog/articles/a-fresh-look-on-reverse-proxy-related-attacks/ (which contains more attacks than just the parsing inconsistencies)

## VPN and secure channels
Regardless of potential privilege escalation, a protocol may provide security properties (integrity, confidentiality, anti-replay...). As a part of a general *Information flow bypass*, the evaluator should try to check whether the protocol itself can be bypassed
 - [TODO] secure channel
 - [TODO] kill switch / firewall part of the secure channel
## FW evasion
 - [TODO] add external resources on FW evasion and discuss - testing FW evasion is tricky, since it is dependent on context, rules expressiveness and usability, etc. For the moment, this aspect is not addressed in this method and is considered more a functional test of the FW capacity than a security topic. The same rules holds for gateway that allow or block traffic based on protocol analyses.
## Diodes and TAPs
 - [TODO] attacks on directionality / protocol translation
 - [TODO] out of scope: HW attacks on optical diodes


# Tamper/craft TOE outputs (pivoting, output poisoning)

The scenario consists in either

* crafting outputs to support another attack (e.g. erasing error messages from a log)
* crafting an input so that the TOE creates a malicious output (e.g. log poisoning). A weaker version consists in using the TOE to tunnel malicious content (e.g. port forwarding to another target).


## log tampering
 - [TODO] erase messages / inject content in the logs
## Tunnel/forward malicious content through the TOE
 - [TODO] see notably SSH forwarding etc
## Emit malicious content through the TOE 
this case is a bit different, since it supposes that the attacker can use the TOE itself to transform input data in malicious data for other systems connected to the TOE. It requires 
 - either that the attacker exploits TOE input transformation rules,  
 - or that the attacker elevates their privileges on the TOE to craft arbitrary malicious data. In real life scenarios,
 - a preauth SSRF can for example be used by an attacker to make a network scan from the TOE and discover its next targets
 - logs could be poisoned so as to include malicious content for the software that will read them
 - etc

[TODO]: add:
 - practical test steps for pentesting the capacity to recompose malicious data through gateways, diodes...
 - how to setup a test lab without real devices (EVE-NG, etc)


