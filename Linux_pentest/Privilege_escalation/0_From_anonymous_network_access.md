---
description: Privilege escalation from anonymous network access
---

# General strategy
From an anonymous access, the evaluator may try to elevate privileges in two main ways:
 - Baby steps: *Bypass identification/authentication* to get a user session - this is a matter of design and/or implementation, and will vastly benefit from the knowledge of ADV_TDS
 - Shortcut: *Trigger a SW bug* on the TOE that will execute arbitrary code or a system command (with the privileges of the compromised network services, either non privileged or privileged). This is a pure implementation problem.
 
 Devising a strategy for constraint time evaluation is not trivial, even if there are general rules of thumb:
 - the *Bypass identification/authentication* approach is generally a good candidate for starting tests, because functional tests are supposedly already present in the documentation
 - the *Trigger a SW bug* approach is not a good candidate if the network services are mostly upstream, up-to-date open source components (bugs may be present but not likely to be found in such a constrained timeframe). Quite the opposite, it may be a good candidate if the developer created a full TCP/IP stack from scratch.

In order to define a test strategy, the evaluator will first make a *detailed inventory of the network services available* and compare it to the available documentation. After having mapped the external interfaces to the underlying network services, the evaluator will be able to decide, for which service, whether to 
 - Review the specifications of the network protocol used?
 - Review the design?
 - Test the configuration and CVEs? 
 - Test the implementation?  


# Review the design
## Bypass identification/authentication
General hints:
 - are all the public exposed resources meant to be available in preauth? 
   - web pages
   - APIs
   - etc.
 - at the applicative layer of exposed resources, are there potential vulns? e.g. identification/authentication forms subject to XSS, SSRFs, etc. more generally [Bugs](#bugs) on a preauth interface 
 - at the underlying layers, what can be done: is it possible to communicate in HTTP before TLS is up? 
## Reauth and error management
General hints:
e.g. VPN. upon error, the tunnel may be closed. The configuration of the VPN will define whether new cleartext will be blocked, or passed in new tunnel or passed in cleartext -> possible leak
See bad strongswan FW rules (auto=start vs auto=route, issues with start_action=none, etc.)

## Access control
General hints:
 - does the stack share resources of different users in the same process, the same database?

# Review the network protocol


## Inventory
What are the protocols used on the channel to the user/other party?
 - which one provides identification/authentication and how (mutual or not, multi factor or not, which types of credentials...)? 
 - which one provides session management and how (tokens, cookies...)?
 - which one provides relay protection and how?
 - which one provides integrity/confidentiality protection and how?
 - which one provides authorization and how?

## Design
Not applicable to known/standard protocols, this makes sense when analyzing a proprietary or rare protocol.
It also makes sense for session management, as there is often no standard protocol involved. Typically, errors in token management may happen easily (e.g. accepting the same token for different users, or on different ports/networks, etc.)

[TODO]: check design of proprietary protocols

## Implementation/configuration 
When a standard protocol provides a given security property (e.g. integrity /confidentiality), you still need to check whether it is correctly implemented - this will be a question of conformance to standards/best practices. This can be checked:
 - either at the network level, when a complete test suite is available:
   - e.g. TLS with Achelos / tlssled
 - or at the [applicative level](_0_Linux_pentest\3_Annex_Applicative_privesc.md)

Is the implementation robust, both for the part that implements the session *and for the underlying network stack*? (think fuzzing)

## Exploit protocol vulnerabilities
On the principle, it consists in
 - perform a MiTM or sniff the network
 - intercept/capture packets 
 - read, replay or transform the packets (and in that case send the transformed packets to the other party)

Some variations are possible, such as exploiting a session that was not clearly terminated to impersonate a party, etc.

### Capture
[TBD] Tips to:
- how to be sure to trigger all actions on the TOE that that will actually create interesting traffic 
- how to denoise captures before analysis 
#### On the network
- setup
- capture : wireshark/tshark, tcpdump, scapy
#### On the TOE
- setup
- eBPF...

### Analysis
How to analyze captured packets:
- origin (traceback) and;
- content (understanding packet analyzers such as Wireshark, snort, tcpdump/windump, fiddler, suricata, netsniff-ng, but also dissection with scapy), and;
- understanding of capture formats (pcap, other?).
### Packet modification or crafting
nc, pwntools...
How to handle packets (scapy, fragroute, etc.). 
The evaluator must ultimately be able to carry out a complete Man-in-the-middle/spoofing attack.
In addition to packet manipulation tools, particularly if he wishes to take advantage of an open sample, the evaluator can also proceed by hooking the TOE or software interacting with the TOE (for example existing test tool), or even modify the source code of such software in order to generate malicious frames.


