---
title: C/C++ code review for AVA_VAN.4 or 5
updated: 2024-05-31 06:57:46Z
created: 2024-05-31 06:54:18Z
---

# Introduction
This method follows the following steps
 - List the applicable standards and requirements 
 - perform code review according to the applicable requirements, in the following order:

     . Analysis of the build (the method is currently built around ````gcc````) [mandatory]

     . Analysis using linters (the method currently uses ````splint```` and ````clang-tidy````) [mandatory]

     . Analysis using SAST tools [optional]

     . Manual review [mandatory]


# List the applicable standards and requirements
List the requirements:
 - Clarify which version of the C standard is meant to be applied.
 - Clarify which coding standard(s) is(are) applicable. If no standard is required, this method backs up to [CERT C](
https://wiki.sei.cmu.edu/confluence/display/c/SEI+CERT+C+Coding+Standard).
 - clarify wich AVA_VAN level is expected from the evaluation.

NB: In the absence of coding standards, additional guidance can also be found in [ANSSI C development rules](https://www.ssi.gouv.fr/en/guide/rules-for-secure-c-language-software-development/).

# Perform the code review for AVA_VAN.4 and 5 [TBD]

As a general rule, AVA_VAN.4 and 5 will both check all L2 and L3 rules.  

NB: this chapter is still under construction.

### Declarations and initializations
List pointers with large storage durations: static, or simply defined outside functions. CHeck if they are assigned with objects with smaller storage duration: [DCL30-C. Declare objects with appropriate storage durations](https://wiki.sei.cmu.edu/confluence/display/c/DCL30-C.+Declare+objects+with+appropriate+storage+durations). Example
```` 
const char *p;
void dont_do_this(void) {
  const char c_str[] = "This will change";
  p = c_str; /* Dangerous */
}
```` 

Check which compiler has been used. If anything other than GCC/Clang 14, list static and extern variables, and search if they may habe been defined twice with varying linkage: [DCL36-C. Do not declare an identifier with conflicting linkage classifications](https://wiki.sei.cmu.edu/confluence/display/c/DCL36-C.+Do+not+declare+an+identifier+with+conflicting+linkage+classifications)


### Expressions
L2: EXP32-C, EXP42-C, EXP45-C, EXP46-C, EXP47-C
L3: EXP35-C, EXP36-C, EXP37-C, EXP38-C, EXP39-C, EXP40-C, EXP43-C, EXP44-C 

### Integers
All are L2/L3

### Floating point
All are  L2/L3

### Arrays
L2: ARR30-C, ARR32-C, ARR36-C, ARR37-C, ARR39-C

### Characters and strings
L2: STR30-C, STR34-C
L3: STR37-C

### Memory management
L2: MEM31-C, MEM35-C
L3: MEM33-C, MEM36-C

### I/O
L2: FIO39-C, FIO45-C, FIO47-C	
L3: FIO32-C, FIO38-C, FIO40-C, FIO41-C, FIO42-C, FIO44-C, FIO46-C

### Signals
L2: SIG31-C
L3: SIG34-C, SIG35-C

### Error handling
L2: ERR30-C
L3: ERR32-C, ERR34-C

### Concurrency

All rules are L2 or L3.

### POSIX
L2: POS34-C, POS44-C, POS49-C
L3: POS38-C, POS48-C, POS50-C, POS51-C, POS52-C, POS53-C

### Misc
L2: MSC30-C, MSC37-C
L3: MSC38-C, MSC39-C, MSC40-C

## L3 rules

### Preprocessor
Search "##" in macros: [PRE30-C. Do not create a universal character name through concatenation](https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152276). 

Beware of cases where preprocessor directives are used inside a function call: [PRE32-C. Do not use preprocessor directives in invocations of function-like macros](https://wiki.sei.cmu.edu/confluence/display/c/PRE32-C.+Do+not+use+preprocessor+directives+in+invocations+of+function-like+macros). Example:
```` 
/* is memcpy is a macro we're in a pickle */
memcpy(dest, src,
#ifdef PLATFORM1
    12
#else
    24
#endif
````
First list the unsafe macros, i.e. those that expand parameters more than once (e.g. 
````#define ABS(x) (((x) < 0) ? -(x) : (x))````)
Then 
 - [PRE31-C. Avoid side effects in arguments to unsafe macros](https://wiki.sei.cmu.edu/confluence/display/c/PRE31-C.+Avoid+side+effects+in+arguments+to+unsafe+macros): check if they are called with a side effect on the argument : assignment, increment, decrement, volatile access, input/output, or other expressions with side effects (including function calls, which may cause side effects), e.g. ````int m = ABS(++n);````

### Declarations and initializations

Check which version has been used for compilation. Ideally ensure that it ensures at least C11 conformance. But if C90 C may have been used:
- search for the ````extern```` keyword, beware of the implicit typing. Other issues, more difficult to detect, here: [DCL31-C. Declare identifiers before using them](https://wiki.sei.cmu.edu/confluence/display/c/DCL31-C.+Declare+identifiers+before+using+them)

Other L3: DCL39-C, DCL40-C, DCL37-C, DCL38-C, DCL41-C


### Environment
L3: ENV30-C, ENV31-C, ENV34-C

# Various resources
## Basics
 - Back To Basics: Undefined Behavior - Ansel Sermersheim & Barbara Geller - CppCon 2021

## On static analysis, code review, formal verification...
 - Journey to a RTE-free X.509 parser - Arnaud Ebalard, Patricia Mouy, and Ryad Benadjila - SSTIC 2019

## Next
Secure coding in C and C++ - ARM_Manual (p26)

CppCon 2018: Patricia Aas “Software Vulnerabilities in C and C++”
https://www.youtube.com/watch?v=0S0QgQd75Sw
# Annex - Hints

Check int size from the shell (important for EOF issues):
````
binary=$(mktemp)
cat <<\EOF | cc -o $binary -x c -
#include <stdio.h>
int main() {
    printf("int=%lu bytes\n", sizeof(int));
    printf("long=%lu bytes\n", sizeof(long));
}
EOF
$binary
rm $binary
````

