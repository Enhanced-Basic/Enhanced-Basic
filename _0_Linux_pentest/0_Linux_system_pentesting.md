---
title: Linux system pentesting
---

- [Attack scenarios](#attack-scenarios)
	- [Requirement](#requirement)
	- [Template](#template)
	- [Notes](#notes)
- [Attack vectors](#attack-vectors)
	- [Requirement](#requirement-1)
	- [Notes](#notes-1)
- [Methods and tools](#methods-and-tools)
	- [Anonymous network access](#anonymous-network-access)
	- [User session, or userland code execution](#user-session-or-userland-code-execution)
		- [General privilege escalation](#general-privilege-escalation)
		- [Focused scenarios](#focused-scenarios)
	- [Root or kernel mode arbitrary code execution](#root-or-kernel-mode-arbitrary-code-execution)
	- [Third-party services used by the TOE](#third-party-services-used-by-the-toe)


# Attack scenarios

## Requirement
**The evaluator _shall_ first read all SFRs/SF in the ST and define a table of scenarios to decline the following attacker objectives:**
 - **_Compromising the security_ of the TOE (the TOE is targeted for its own assets), or**
 - **_Compromising the trustworthiness_ of the TOE, a.k.a. _pivoting_ (the TOE is used is a springboard to compromise the security of _another product or system_ that uses/trusts it).**

**The evaluator _should_ use the following template as a basis, and add any other relevant scenario depending on the ST (other primary security functions of the TOE, _deeper_ support functions such as system hardening, secure boot, physical protection...)**

## Template 

| Security Function | _Compromise the security_ of the TOE | _Compromise the trustworthiness_ of the TOE | 
| :---- | :----   |          :--- | 
| Level 1 - Primary security feature(s) of the TOE. <br>_Example: information flow control (VPNs, diodes, firewalls...)._ | Bypass/disable the main security feature(s) and interface(s) of the TOE. <br>_Following the example: **Bypass flow control** (e.g. evading firewalling, tampering/eavesdropping protected traffic...)_| **Tamper/craft TOE outputs** so that its interfaces can be used to attack other users or IT Products | 
| Level 2 - Access control on the TOE | **Bypass identification/authn/authz/access control** in order to facilitate Level 1 scenarios | **Bypass identification/authn/authz/access control** in order to facilitate Level 1 scenarios | 
| Level 3 - Audit | **Tamper/craft TOE outputs**, typically compromise audit logs in order to facilitate or mask Level 2 scenarios | **Tamper/craft TOE outputs**, typically compromise audit logs in order to facilitate or mask Level 2 scenarios | 

## Notes 
 - The template is _levelled_ because SFs are not all born equal: some are meant to protect primary assets, and many others are merely there to support these primary SFs. 
 - The template defines the following _scenarios_ as a minimum:
	 - Bypass flow control
	 - Tamper/craft TOE outputs
	 - Bypass identification/authn/authz/access control
   They correspond to groups of SFs that are often found in most types of TOEs. They obviously need to be completed/adapted for each TOE.


# Attack vectors
## Requirement
The evaluator _shall_ explore _all the scenarios from all possible attack vectors_ unless proven irrelevant. Attack vectors shall include at least:
 - From Anonymous network access (including network or offline third-party services)
	 - to Applicative user session
	 - to Code execution
 - From Applicative user session
	 - to Non-privileged code execution
	 - to Non-privileged system command execution
 - From Non-privileged code execution
	 - to Non-privileged (reverse) Shell
 - From Non-privileged system command execution
	 - to Non-privileged (reverse) Shell
 - From Non-privileged (reverse) Shell
	 - to Privileged code execution / shell
 - From Privileged code execution / shell
	 - to persistence

## Notes 
 - Assumptions in the security target may lead to discard or otherwise limit some of these _as possible initial attack vectors_ (e.g. some groups of users may be trusted by assumption). However, privilege escalation plays a large part in the method: the evaluator may therefore "unlock" attack vectors during the evaluation, as they progress in their analysis.
 - For the same reason, it is recommended to begin the analysis with the highest initial level of privilege granted to potential attackers. E.g. if attackers can have access to `User sessions (local or over the network), or userland code execution`, analyze this attack vector before analyzing `Anonymous network access`
 - the method of the pentester stays the same whether the TOE includes the Linux OS or not - however the evaluator needs to be careful to focus their efforts to the scope of the TOE.

# Methods and tools

## Anonymous network access

The first step from this vector consists in making an **Inventory of network connections** (see [Network privilege escalation method](2_Annex_Network_privesc.md)).
Then, the evaluator should analyze the attack paths listed in he following table. Once all these paths are analyzed, remains the possibility for the attacker to [elevate privileges](2_Annex_Network_privesc.md) and then try scenarios from the next section [User session, or userland code execution](#user-session-or-userland-code-execution).

| Scenario  | Attack path | Method and tools | 
| :----    |          :--- |           :--- | 
| **Bypass flow control**:<br>The typical example of flow control is a firewall TOE, which will filter/block/allow data traffic. The actual flow control fucntionality will depend on the TOE. | In this example, _bypassing control flow_ means evading the FW rules. Similar types of attacks can concern diodes or gateways. | [Network privilege escalation method](2_Annex_Network_privesc.md): Bypass flow control|
| **Tamper/craft TOE outputs**:<br>The only accessible inputs /outputs are those that transit on the network, whether they are data outputs (such as API for other IT products) or user outputs (web, rsyslog...) |Exploiting a weak protection to replay, eavesdrop, tamper or craft protected packets | [Network privilege escalation method](2_Annex_Network_privesc.md): Protocol analysis |
||Pass an input that will functionally be reflected as a malicious TOE output: This topic is typical for gateways or reverse proxies.| [Network privilege escalation method](2_Annex_Network_privesc.md): Pass or craft malicious data through the TOE |
|  **Bypass identification/authn/authz/access control**:<br>An anonymous attacker scans the network TOE interfaces, then exploits a vulnerable network service to elevate their privilege | Search protocol vulnerabilities | [Network privilege escalation method](2_Annex_Network_privesc.md): Search protocol vulnerabilities|
|| Search applicative vulnerabilities in the network service involved | [Applicative privilege escalation method](3_Annex_Applicative_privesc.md): Search applicative vulnerabilities |

## User session, or userland code execution

### General privilege escalation
As a first step the evaluator **shall** first assess whether a general [privilege escalation](1_Annex_Linux_privesc.md) is possible on the TOE. Hereafter a few examples of attack paths that can be realized through such an escalation:
 - Alter the services in charge of the firewall to allow evasion (**Bypass flow control**)
 - Alter security-related data (e.g. allowed ciphersuites, SSH tunnelling options...)  (**Bypass identification/authn/authz/access control**)
 - Alter content (include a covert/malicious payload in existing DNS or ICMP requests) (**Tamper/craft TOE outputs**)
 - Alter audits logs change/delete records, or to trigger bugs on log-parsing tools  (**Tamper/craft TOE outputs**, **Bypass identification/authn/authz/access control**)
 - Alter user interface for social engineering, e.g. to obtain credentials (**Tamper/craft TOE outputs**, **Bypass identification/authn/authz/access control**)
 - Read/write existing sockets in order to map/sniff the network from the TOE, or even send an arbitrary payload on a third-party.<br>Variation: install and/or run tools with such network capabilities (**Bypass identification/authn/authz/access control**, **Tamper/craft TOE outputs**)
 - Generically: access any asset that is not allowed for this user in the ST: SSH credentials of other users in memory, other users data on the filesystem... (**Bypass identification/authn/authz/access control**)
 - ...

### Focused scenarios
Only afterwards, the evaluator **shall** assess the scenarios listed in the table below:

| Scenario  | Attack path | Method and tools | 
| :----    |          :--- |           :--- | 
| **Bypass flow control**:<br>As in an anonymous access, the typical example of flow control is a firewall TOE, which will filter/block/allow data traffic. The actual flow control fucntionality will depend on the TOE.  | Direct attack on the network | [Network privilege escalation method](2_Annex_Network_privesc.md): Bypass flow control|
| **Tamper/craft TOE outputs**:<br>TOE outputs are **network outputs** (incl. applicative outputs such as web pages) or **user outputs** (such as GUI, logs and errors).  | Exploit a weak protection to replay, eavesdrop, tamper or craft protected packets | [Network privilege escalation method](2_Annex_Network_privesc.md): Protocol analysis |
|**Bypass identification/authn/authz/access control**| Perform an  Applicative privilege escalation |[Applicative privilege escalation](3_Annex_Applicative_privesc.md)|
||Perform a Public vulnerability analysis|[Public vulnerability analysis](../../../Pentesting/Pentesting%20methods%20and%20tools/Public%20vulnerability%20analysis/Public%20vulnerability%20analysis%20101.md) |


## Root or kernel mode arbitrary code execution 
This attack vector is relevant in two situations:
 - exploiting further a root access to reach a given asset. We an example of this in the [privilege escalation method](1_Annex_Linux_privesc.md): "we have root but are not able to read cleartext credentials that are exchanged in an SSH session because everything is done in memory"
 - search post exploitation techniques (persistence, deletion of traces, and so on)

The former may have sense in some very specific cases of evaluations, but as a general rule, root is trusted, and root privilege escalation should in itself cause a failure of the AVA_VAN component. For this reason, we will not detail further the attack scenarios until a real life evaluation makes us look into these exploitation techniques. 

## Third-party services used by the TOE	

Third party services used by the TOE are possible attack vectors, especially when they are trusted by design or even roots of trust. We will not detail the possible attack scenarios, though, because in the context of a CC evaluation, such third-parties are trusted by assumptions. What needs to be checked, though, is:
 - the completeness of the ST and AGD docu√∂ents:
	 - does the product use a third-party SSO? PKI?
	 - does the product rely on a back office for licensing, product updates? is the channel safe? 
	 - does the product rely on repositories to update 3rd party building blocks (distro, libraries...)? does it use non official repositories? 
	 - etc.
 - the security of the connection to all these third-parties (this is adressed in the section [Anonymous network access](#anonymous-network-access))


